module.exports = {
  hooks: {
    "page:before": function(page) {
      var fnArray = [];
      var reffnPat = /\[\^([^\[\]0-9]+[^\[\]]*|[^\[\]]*[^\[\]0-9]+)\]/g

      while ((reffnArray = reffnPat.exec(page.content)) !== null) {
        var label = reffnArray[1];
        var index = fnArray.indexOf(label);
        var pattern = new RegExp('\\[\\^' + label + '\\]', 'g');
        if (index > -1) {
          page.content = page.content.replace(pattern, '[^' + (index + 1) + ']');
        } else {
          fnArray.push(label);
          page.content = page.content.replace(pattern, '[^' + fnArray.length + ']');
        }
      }

      return page;
    }
  }
};
